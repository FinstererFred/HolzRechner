<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>HolzRechner</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/custom.css" rel="stylesheet">
    <link href="css/bootstrap-datepicker3.css" rel="stylesheet">
    <link href="css/font-awesome.min.css" rel="stylesheet">

    <!-- Bootstrap -->

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>

    <div class="container">
        <div class=" clearfix">
            <nav>
				<ul class="nav nav-tabs">
					<li role="presentation" class="active"><a href="#">Neuer Hieb</a></li>
                    <li id="archiv" role="presentation"><a href="#">Archiv <span class="badge">42</span></a></li>
				</ul>
            </nav>
          
        </div>

        <div class="row marketing">
        	<div class="header clearfix">
	        	<div class="btn-group" role="group" aria-label="..." id="subNav">
				  <button type="button" class="btn btn-default active" id="navHieb">Daten</button>
				  <button type="button" class="btn btn-default" id="navStamm">Stamm</button>
				  <button type="button" class="btn btn-default" id="navListe">Liste <span class="badge">0</span></button>
				</div>
            </div>

        	<!-- Dateneingabe -->    
	            <div class="col-lg-12 layer" id="layHieb">
	                <form class="form-horizontal" >
	                    <div class="form-group" id="grpName">
	                        <label for="inputName" class="col-sm-3 control-label">Name</label>
	                        <div class="col-sm-9 " >
	                            <input type="text" class="form-control" id="inputName" placeholder="" value="name">
	                        </div>
	                    </div>
	                    <div class="form-group" id="grpBestand">
	                        <label for="inputBestand" class="col-sm-3 control-label">Bestand</label>
	                        <div class="col-sm-9">
	                            <input type="text" class="form-control" id="inputBestand" placeholder="" value="bestand">
	                        </div>
	                    </div>
	                    <div class="form-group" id="grpDatum">
	                        <label for="inputDatum" class="col-sm-3 control-label">Datum</label>
	                        <div class="col-sm-9">
	                           <input type="text" type="text" class="form-control" id="inputDatum" value="01.01.1970" readonly>
	                        </div>
	                    </div>
	                    
	                </form>
	            </div>
        
            <!-- Stammeingabe -->
	            <div class="col-lg-12 layer" style="display:none" id="layStaemme">
	                <form class="form-horizontal">
	                    <div class="form-group form-group-lg">
	                        <br class="hidden-sm hidden-md hidden-lg"/>
	                        <label for="stammArt" class="col-sm-3 control-label hidden-xs">Baumart</label>
	                        <div class="col-sm-9">
	                        	<div class="col-sm-4">
		                            <select class="form-control" id="stammArt">
			                              <option value="-1"></option>
			                              <option value="0">Fichte</option>
			                              <option value="1">Kiefer</option>
			                              <option value="2">Tanne</option>
			                              <option value="3">Douglasie</option>
			                              <option value="4">Eiche</option>
			                              <option value="5">Buche</option>
			                              <option value="6">Birke</option>
			                              <option value="7">Lärche</option>
			                              <option value="8">Sonstige</option>
			                        </select>
			                    </div>
	                        </div>
	                    </div>
	                    
	                    <div class="form-group">
	                        <label for="stammRinde" class="col-sm-3 control-label hidden-xs">Rindenabzug</label>
	                        <div class="col-sm-9">
	                         	<div class="col-sm-6 input-group">
	                        		<div class="checkbox">
										<label>
	                        				<input type="checkbox" id="stammRinde" value="option1" aria-label="..." class="checkStyle"> <span class="hidden-sm hidden-md hidden-lg">Rindenabzug</span>
	                        			</label>
	                        		</div>
	                        	</div>
	                       	</div>
	                    </div>

	                    <div class="form-group">
	                        <label for="stammAbschnitt" class="col-sm-3 control-label hidden-xs">Abschnitte</label>
	                        <div class="col-sm-9">
	                        	<div class="col-sm-6 input-group">
	                        		<div class="checkbox">
										<label>
	          								<input type="checkbox" id="stammAbschnitt" value="option2" aria-label="..." class="checkStyle"> <span class="hidden-sm hidden-md hidden-lg">Abschnitte</span>
	        							</label>
        							</div>
	                        	</div>
	                       	</div>
	                    </div>

	                    <div class="form-group form-group-lg">
	                       <label for="inputLaenge" class="col-sm-3 control-label hidden-xs">Länge (m)</label>
	                        <div class="col-sm-9 ">
	                            <div class="col-sm-5 col-md-6">
      	                          <input type="tel" class="form-control" id="inputLaenge" placeholder="Länge (m)">
	    	                    </div>
	                        </div>
	                    </div>

	                    <div class="form-group form-group-lg">
	                        <label for="inputDurchmesser" class="col-sm-3 control-label  hidden-xs">Durchmesser (cm)</label>
	                        <div class="col-sm-9 ">
	                            <div class="col-sm-5 col-md-6">
      	                           <div class="input-group">
      	                          <input type="tel" class="form-control" id="inputDurchmesser" placeholder="&oslash; (cm)">
	                            	<span class="input-group-btn">
	                            	<button class="btn btn-default btn-lg" type="button" id="btnBerechnen"><i class="fa fa-calculator"></i> <span id="volumenErgebnis">0.00</span>m&sup3;</button>
	    	                       </span>
	    	                       </div>
	                            </div>

	                        </div>
	                    </div>

	                   
	                    
	                </form>
	            </div>

			<!-- Stammliste -->
	            <div class="col-lg-12 layer" style="display:none" id="layListe">
	                <form class="form-horizontal">
	                    <div class="form-group">
	                        <label for="inputListe" class="col-sm-3 control-label">Liste</label>
	                        <div class="col-sm-9">
	                            <input type="text" class="form-control" id="inputListe" placeholder="">
	                        </div>
	                    </div>
	                    
	                    <button type="button" class="btn btn-default pull-right" disabled>Hieb speichern und Eingabe beenden</button>
	                </form>
	            </div>

        </div>


        <footer class="footer">
            <p>&copy; Company 2014</p>
        </footer>

    </div>
    <!-- /container -->

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/bootstrap-datepicker.min.js"></script>
    <script src="js/locales/bootstrap-datepicker.de.js"></script>

</body>

</html>


<script type="text/JavaScript">

	var newHieb;

	$(function ()
	{
		$('#inputDatum').datepicker(
		{
		    format: "dd.mm.yyyy",
		    todayBtn: "linked",
		    language: "de",
		    todayHighlight: true,
		    orientation: "bottom auto",
		});

		/* Tabs */
			$('#navHieb').on('click', function()
			{
				$('#subNav button').removeClass('active');
				$(this).addClass('active');	
				$('.layer').hide();
				$('#layHieb').show();
			});

			$('#navStamm').on('click', function()
			{

				newHieb = new Hieb(true);

				if( newHieb.isValid() )
				{
					$('#subNav button').removeClass('active');
					$(this).addClass('active');	
					$('.layer').hide();
					$('#layStaemme').show();
				}
			});

			$('#navListe').on('click', function()
			{
				$('#subNav button').removeClass('active');
				$(this).addClass('active');	
				$('.layer').hide();
				$('#layListe').show();
			});



		/* Buttons */
			$('#btnBerechnen').on('click', function() 
			{
				var _laenge = $('#inputLaenge').val();
				var _durchmesser = $('#inputDurchmesser').val();
				var _stammArt = $('#stammArt').val();
				var _stammRinde = $('#stammRinde').prop('checked');

				newHieb.addStamm( new Stamm( _durchmesser,_laenge,_stammArt, _stammRinde ) );

				$('#inputLaenge').val('');
				$('#inputDurchmesser').val('');
				$('#inputLaenge').focus();
			});

		/* input felder */
			$('#inputLaenge').on('keyup', function(event)
			{
				//alert(event.keyCode);
				if(event.keyCode == 13)
				{
					$('#inputDurchmesser').focus();	
				}
			});

			

	});

	function Hieb(newH) 
	{
	    /* eigenschaften von hieb */
		    this.staemme = [];
	 		this.valid = true;
	 		this.name = '';
	 		this.bestand = '';
	 		this.datum = '';

		/* constructor, wird von tab staemme aufgerufen */	 		
	 		if(newH)
	 		{
	 			this.init();
	 		}

	}

		Hieb.prototype = 
		{
		    init: function()
		    {
		    	var name = $('#inputName').val();
		    	var bestand = $('#inputBestand').val();
		    	var datum = $('#inputDatum').val();

		    	$('#layHieb div').removeClass('has-error');

		    	if(name.length == 0) {$('#grpName').addClass('has-error'); this.valid = false; } else { this.name = name; }
		    	if(bestand.length == 0) {$('#grpBestand').addClass('has-error'); this.valid = false; } else { this.bestand = bestand; }
		    	if(datum.length == 0) {$('#grpDatum').addClass('has-error'); this.valid = false; } else { this.datum = datum; }
		    },

		    addStamm: function(st) 
		    {
		        this.staemme.push(st);
		        this.staemme[this.getStammCount()-1].position = this.getStammCount();
		    }, 

		    loescheStamm: function(st)
		    {
		    	;
		    },

		    speichern: function()
		    {
		    	;
		    }, 

		    isValid: function()
		    {
		    	return this.valid;
		    }, 

		    getStammCount: function()
		    {
		    	return this.staemme.length;
		    }
		}

	function Stamm(durchmesser, laenge, baumart, rindenAbzug) 
	{
	    this.durchmesser = durchmesser;
	    this.laenge = laenge;
	    this.baumart = baumart;
	    this.rindenAbzug = rindenAbzug;
	    this.rindenAbzugWert = 0;
	    this.staerkeKlasse = 0;
	    this.volumen = 0;

	    this.init();
	}

		Stamm.prototype = 
		{
		    init: function ()
		    {
		    	this.findStaerkeKlasse(this.durchmesser);
		    	
		    	if(this.rindenAbzug)
		    	{
		    		this.findRindenAbzug(this.durchmesser);
		    	}

		    	this.berechnen();
		    },

		    meldung: function() 
		    {
		        alert(this.durchmesser);
		    }, 

		    speichern: function()
		    {
		    	;
		    },

		    loeschen: function()
		   	{
		   		;
		   	},

		   	berechnen: function()
		   	{
		   		this.volumen = ((Math.PI/4 * Math.pow( (this.durchmesser-this.rindenAbzugWert), 2) ) * this.laenge ) / 10000;
				$('#volumenErgebnis').html( this.volumen.toFixed(2) );
		   	},

		   	findStaerkeKlasse: function()
	   		{
	   			var durchmesser = this.durchmesser;

	   			for( var i in staerkeKlassen)
	   			{
	   				if( durchmesser >= staerkeKlassen[i]['von'] && durchmesser <= staerkeKlassen[i]['bis'] )
	   				{
	   					this.staerkeKlasse = i;
	   					return;
	   				}
	   			}
	   		},

	   		findRindenAbzug: function()
			{
				var abzug = baeume[this.baumart]['abzug'];
				var staerkeKlasse = this.staerkeKlasse;

				for( var i in rindenAbzug[abzug])
				{
					if( staerkeKlasse >= rindenAbzug[abzug][i]['von'] && staerkeKlasse <= rindenAbzug[abzug][i]['bis'] )
					{
						this.rindenAbzugWert = rindenAbzug[abzug][i]['abzug'];
						return;
					}
				}
			}


		}
	/* stammdaten */
	var staerkeKlassen = 
	{
		0: {'name': '0',  'von' :0 , 'bis': 9 },
		1: {'name': '1a', 'von' :10, 'bis': 14},
		2: {'name': '1b', 'von' :15, 'bis': 19},
		3: {'name': '2a', 'von' :20, 'bis': 24},
		4: {'name': '2b', 'von' :25, 'bis': 29},
		5: {'name': '3a', 'von' :30, 'bis': 34},
		6: {'name': '3b', 'von' :35, 'bis': 39},
		7: {'name': '4',  'von' :40, 'bis': 49},
		8: {'name': '5',  'von' :50, 'bis': 59},
		9: {'name': '6',  'von' :60, 'bis': 69},
		10: {'name': '7', 'von' :70, 'bis': 79},
		11: {'name': '8', 'von' :80, 'bis': 89}
	}

	var rindenAbzug = 
	{
		0 : { 
			0: { 'von': 0, 'bis': 4, 'abzug': 1},
			1: { 'von': 5, 'bis': 8, 'abzug': 2},
			2: { 'von': 9, 'bis': 100, 'abzug': 3}
		},

		1 : { 
			0: { 'von': 0, 'bis': 2, 'abzug': 1},
			1: { 'von': 3, 'bis': 5, 'abzug': 2},
			2: { 'von': 6, 'bis': 8, 'abzug': 3},
			3: { 'von': 9, 'bis':100, 'abzug': 4}
			
		},

		2 : { 
			0: { 'von': 0, 'bis': 6, 'abzug': 1},
			1: { 'von': 7, 'bis': 100, 'abzug': 2}		
		},

		3 : { 
			0: { 'von': 0, 'bis': 3, 'abzug': 1},
			1: { 'von': 4, 'bis': 4, 'abzug': 2},
			2: { 'von': 5, 'bis': 6, 'abzug': 3},
			3: { 'von': 7, 'bis': 7, 'abzug': 4},
			4: { 'von': 8, 'bis': 100, 'abzug': 5}
		}
	}

	var baeume = 
	{
		0 : {'name': 'Fichte', 		'abzug': 0},
		1 : {'name': 'Kiefer',		'abzug': 1},
		2 : {'name': 'Tanne',		'abzug': 0},
		3 : {'name': 'Douglasie',	'abzug': 1},
		4 : {'name': 'Eiche',		'abzug': 3},
		5 : {'name': 'Buche',		'abzug': 2},
		6 : {'name': 'Birke',		'abzug': 2},
		7 : {'name': 'Lärche',		'abzug': 1},
		8 : {'name': 'Sonstiger',	'abzug': 0}
	}

	function findStaerkeKlasse (durchmesser)
	{
		for( var i in staerkeKlassen)
		{
			if( durchmesser >= staerkeKlassen[i]['von'] && durchmesser <= staerkeKlassen[i]['bis'] )
			{
				return i;
			}
		}
	}

	function findRindenAbzug(abzug, staerkeKlasse)
	{
		for( var i in rindenAbzug[abzug])
		{
			if( staerkeKlasse >= rindenAbzug[abzug][i]['von'] && staerkeKlasse <= rindenAbzug[abzug][i]['bis'] )
			{
				return rindenAbzug[abzug][i]['abzug'];
			}
		}
	}

</script>